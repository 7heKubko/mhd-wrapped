<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MHD Wrapped - 맚atistiky</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js Annotation plugin for reference lines -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
  <!-- html2canvas for sharing stats as image -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
  <main class="page">
    <h1 class="page-title">游늳 맚atistiky</h1>
    <div class="stats-filter-bar">
      <label for="statsYearSelect">Zobrazi콘 코tatistiky za rok:</label>
      <select id="statsYearSelect">
        <option value="all">V코etky roky</option>
      </select>
    </div>

    <section class="card fade-in">
      <h2>Najpou쮂셨anej코ie linky</h2>
      <canvas id="chartLines"></canvas>
      <button id="toggleLinesChart" style="margin-top:10px">Zobrazi콘 v코etky linky</button>
    </section>

    <section class="card fade-in">
      <h2>Typy vozidiel</h2>
      <canvas id="chartVehicles"></canvas>
      <button id="toggleVehiclesChart" style="margin-top:10px">Zobrazi콘 v코etky typy</button>
    </section>

    <section class="card fade-in">
      <h2>Vozidla pod쬬 E캛V</h2>
      <canvas id="chartByECV"></canvas>
      <button id="toggleECVChart" style="margin-top:10px">Zobrazi콘 v코etky vozidl치</button>
    </section>

    <section class="card fade-in">
      <h2>Jazdy pod쬬 hod칤n</h2>
      <canvas id="chartHours"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Po캜et j치zd pod쬬 dn칤 v t칳쬯ni</h2>
      <canvas id="chartByWeekday"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Po캜et j치zd pod쬬 mesiacov</h2>
      <canvas id="chartByMonth"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Po캜et j치zd pod쬬 typu pohonu</h2>
      <canvas id="chartByDriveType"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Po캜et j치zd po캜as sviatkov/pr치zdnin</h2>
      <canvas id="chartByHoliday"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Po캜et j치zd pod쬬 typu vozidla</h2>
      <canvas id="chartByVehicleType"></canvas>
    </section>

    <section class="card fade-in">
      <h2>Wrapped</h2>
      <div class="wrapped-grid">
        <div class="wrapped-item"><div class="wrapped-label">Po캜et j치zd</div><div class="wrapped-value" id="wTotal">0</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top linka</div><div class="wrapped-value" id="wTopLine">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top model na linke <span id="dynamicTopLine"></span></div><div class="wrapped-value" id="wTopModelOnLine">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Naj캜astej코칤 typ vozidla</div><div class="wrapped-value" id="wTopMode">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top vozidlo</div><div class="wrapped-value" id="wTopBus">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Persona</div><div class="wrapped-value" id="wPersona">Nov치캜ik</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Po캜et r칪znych liniek</div><div class="wrapped-value" id="wUniqueLines">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Po캜et r칪znych vozidiel</div><div class="wrapped-value" id="wUniqueVehicles">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Rekordn칳 de켿 (najviac j치zd)</div><div class="wrapped-value" id="wRecordDay">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Priemern칳 po캜et j치zd za de켿</div><div class="wrapped-value" id="wAvgPerDay">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Priemern칳 po캜et j치zd za t칳쬯e켿</div><div class="wrapped-value" id="wAvgPerWeek">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Priemern칳 po캜et j치zd za mesiac</div><div class="wrapped-value" id="wAvgPerMonth">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Najdlh코ia s칠ria dn칤 s jazdou</div><div class="wrapped-value" id="longestStreak">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Najdlh코ia pauza bez MHD</div><div class="wrapped-value" id="longestPause">-</div></div>
      </div>
      <div id="perLineMiniCards" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap"></div>
    </section>

    

  </main>

  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <div class="nav-icon">游</div>
      <div class="nav-text">Domov</div>
    </a>
    <a href="history.html" class="nav-item">
      <div class="nav-icon">游닄</div>
      <div class="nav-text">Hist칩ria</div>
    </a>
    <a href="stats.html" class="nav-item active">
      <div class="nav-icon">游늳</div>
      <div class="nav-text">맚atistiky</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">丘뙖잺</div>
      <div class="nav-text">Nastavenia</div>
    </a>
  </nav>

  <div id="toast"></div>

  <script type="module" src="stats.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btn = document.getElementById("shareStatsBtn");
      const wrappedSection = document.querySelector(".wrapped-grid");
      if (btn && wrappedSection) {
        btn.addEventListener("click", async () => {
          btn.disabled = true;
          btn.textContent = "Generujem...";
          wrappedSection.classList.add("share-screenshot");
          await new Promise(r => setTimeout(r, 100));
          html2canvas(wrappedSection, {backgroundColor: null, scale: 2}).then(canvas => {
            wrappedSection.classList.remove("share-screenshot");
            const link = document.createElement('a');
            link.download = 'mhd-wrapped-statistiky.png';
            link.href = canvas.toDataURL();
            link.click();
            btn.textContent = "Stiahnu콘 obr치zok";
            btn.disabled = false;
          }).catch(() => {
            btn.textContent = "Stiahnu콘 obr치zok";
            btn.disabled = false;
            alert("Nepodarilo sa vygenerova콘 obr치zok.");
          });
        });
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const topLineElement = document.getElementById("wTopLine");
      const dynamicTopLineElement = document.getElementById("dynamicTopLine");
      if (topLineElement && dynamicTopLineElement) {
        dynamicTopLineElement.textContent = topLineElement.textContent.split(" ")[0] || "-";
      }
    });
  </script>
</body>
</html>
