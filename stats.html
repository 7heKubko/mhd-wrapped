<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MHD Wrapped - Å tatistiky</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- html2canvas for sharing stats as image -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
  <main class="page">
    <h1 class="page-title">ğŸ“ˆ Å tatistiky</h1>
    <div class="stats-filter-bar">
      <label for="statsYearSelect">ZobraziÅ¥ Å¡tatistiky za rok:</label>
      <select id="statsYearSelect">
        <option value="all">VÅ¡etky roky</option>
      </select>
    </div>

    <section class="card fade-in">
      <h2>NajpouÅ¾Ã­vanejÅ¡ie linky</h2>
      <canvas id="chartLines"></canvas>
      <button id="toggleLinesChart" style="margin-top:10px">ZobraziÅ¥ vÅ¡etky linky</button>
    </section>

    <section class="card fade-in">
      <h2>Typy vozidiel</h2>
      <canvas id="chartVehicles"></canvas>
      <button id="toggleVehiclesChart" style="margin-top:10px">ZobraziÅ¥ vÅ¡etky typy</button>
    </section>

    <section class="card fade-in">
      <h2>Vozidla podÄ¾a EÄŒV</h2>
      <canvas id="chartByECV"></canvas>
      <button id="toggleECVChart" style="margin-top:10px">ZobraziÅ¥ vÅ¡etky vozidlÃ¡</button>
    </section>

    <section class="card fade-in">
      <h2>Jazdy podÄ¾a hodÃ­n</h2>
      <canvas id="chartHours"></canvas>
    </section>

    <section class="card fade-in">
      <h2>PoÄet jÃ¡zd podÄ¾a dnÃ­ v tÃ½Å¾dni</h2>
      <canvas id="chartByWeekday"></canvas>
    </section>

    <section class="card fade-in">
      <h2>PoÄet jÃ¡zd podÄ¾a mesiacov</h2>
      <canvas id="chartByMonth"></canvas>
    </section>

    <section class="card fade-in">
      <h2>PoÄet jÃ¡zd podÄ¾a typu pohonu</h2>
      <canvas id="chartByDriveType"></canvas>
    </section>

    <section class="card fade-in">
      <h2>PoÄet jÃ¡zd poÄas sviatkov/prÃ¡zdnin</h2>
      <canvas id="chartByHoliday"></canvas>
    </section>

    <section class="card fade-in">
      <h2>PoÄet jÃ¡zd podÄ¾a typu vozidla</h2>
      <canvas id="chartByVehicleType"></canvas>
    </section>

    <section class="card fade-in">
      <h2>MesaÄnÃ© Å¡tatistiky</h2>
      <div class="month-switch">
        <button id="prevMonth">â† PredchÃ¡dzajÃºci mesiac</button>
        <span id="monthLabel"></span>
        <button id="nextMonth">NasledujÃºci mesiac â†’</button>
      </div>
      <ul id="monthStats"></ul>
    </section>

    <section class="card fade-in">
      <h2>Wrapped</h2>
      <div class="wrapped-grid">
        <div class="wrapped-item"><div class="wrapped-label">PoÄet jÃ¡zd</div><div class="wrapped-value" id="wTotal">0</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top linka</div><div class="wrapped-value" id="wTopLine">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top model na linke <span id="dynamicTopLine"></span></div><div class="wrapped-value" id="wTopModelOnLine">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">NajÄastejÅ¡Ã­ typ vozidla</div><div class="wrapped-value" id="wTopMode">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Top vozidlo</div><div class="wrapped-value" id="wTopBus">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">Persona</div><div class="wrapped-value" id="wPersona">NovÃ¡Äik</div></div>
        <div class="wrapped-item"><div class="wrapped-label">PoÄet rÃ´znych liniek</div><div class="wrapped-value" id="wUniqueLines">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">PoÄet rÃ´znych vozidiel</div><div class="wrapped-value" id="wUniqueVehicles">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">RekordnÃ½ deÅˆ (najviac jÃ¡zd)</div><div class="wrapped-value" id="wRecordDay">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">PriemernÃ½ poÄet jÃ¡zd za deÅˆ</div><div class="wrapped-value" id="wAvgPerDay">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">PriemernÃ½ poÄet jÃ¡zd za tÃ½Å¾deÅˆ</div><div class="wrapped-value" id="wAvgPerWeek">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">PriemernÃ½ poÄet jÃ¡zd za mesiac</div><div class="wrapped-value" id="wAvgPerMonth">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">NajdlhÅ¡ia sÃ©ria dnÃ­ s jazdou</div><div class="wrapped-value" id="longestStreak">-</div></div>
        <div class="wrapped-item"><div class="wrapped-label">NajdlhÅ¡ia pauza bez MHD</div><div class="wrapped-value" id="longestPause">-</div></div>
      </div>
    </section>

  </main>

  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-text">Domov</div>
    </a>
    <a href="history.html" class="nav-item">
      <div class="nav-icon">ğŸ“š</div>
      <div class="nav-text">HistÃ³ria</div>
    </a>
    <a href="stats.html" class="nav-item active">
      <div class="nav-icon">ğŸ“ˆ</div>
      <div class="nav-text">Å tatistiky</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">âš™ï¸</div>
      <div class="nav-text">Nastavenia</div>
    </a>
  </nav>

  <div id="toast"></div>

  <script type="module" src="stats.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btn = document.getElementById("shareStatsBtn");
      const wrappedSection = document.querySelector(".wrapped-grid");
      if (btn && wrappedSection) {
        btn.addEventListener("click", async () => {
          btn.disabled = true;
          btn.textContent = "Generujem...";
          wrappedSection.classList.add("share-screenshot");
          await new Promise(r => setTimeout(r, 100));
          html2canvas(wrappedSection, {backgroundColor: null, scale: 2}).then(canvas => {
            wrappedSection.classList.remove("share-screenshot");
            const link = document.createElement('a');
            link.download = 'mhd-wrapped-statistiky.png';
            link.href = canvas.toDataURL();
            link.click();
            btn.textContent = "StiahnuÅ¥ obrÃ¡zok";
            btn.disabled = false;
          }).catch(() => {
            btn.textContent = "StiahnuÅ¥ obrÃ¡zok";
            btn.disabled = false;
            alert("Nepodarilo sa vygenerovaÅ¥ obrÃ¡zok.");
          });
        });
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const topLineElement = document.getElementById("wTopLine");
      const dynamicTopLineElement = document.getElementById("dynamicTopLine");
      if (topLineElement && dynamicTopLineElement) {
        dynamicTopLineElement.textContent = topLineElement.textContent.split(" ")[0] || "-";
      }
    });
  </script>
</body>
</html>
